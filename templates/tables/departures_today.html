{{ define "main_content" }}

<div id="myGrid" style="height: 100%;width:98%;" class="ag-theme-balham"></div>
<script type="module" charset="utf-8">
    import {CustomDateComponent} from '../grid/js/src/custom_filters.js';
    import {getDay, getMonth, getYear, getHour, getMinute, buildGrid} from '../grid/js/src/main.js';
    // specify the columns
    var columnDefs = [
      {headerName: "id", field: "id_trip", width: 60, filter: "agNumberColumnFilter"},
      {headerName: "Ship", field: "ship_name", filter: "agTextColumnFilter" },
      {headerName: "Type", field: "ship_type", width: 80, filter: "agTextColumnFilter"},
      //  grossTonnage, length, width, shippedGoods, tsPlannedMooring, tsReadiness

      {headerName: "Departure",
      children: [
      {
        headerName: "DD/MM/YYYY", 
        width: 120, 
        field: "ts_out_of_sight",
        valueGetter: (value) => {
          return moment(value.data.ts_out_of_sight, "YYYY-MM-DD HH:mm").format("DD/MM/YYYY")
        },
        filter:"agDateColumnFilter", 
        filterParams:{
          comparator:function (filterLocalDateAtMidnight, cellValue){
              var dateAsString = cellValue.split(" ")[0];
              if (dateAsString == null) return -1;
              var dateParts  = dateAsString.split("/");
              var cellDate = new Date(Number(dateParts[2]), Number(dateParts[1]) - 1, Number(dateParts[0]));
              if (filterLocalDateAtMidnight.getTime() == cellDate.getTime()) {
                  return 0
              }
  
              if (cellDate < filterLocalDateAtMidnight) {
                  return -1;
              }
  
              if (cellDate > filterLocalDateAtMidnight) {
                  return 1;
              }
          }
        }
      },
      {
        headerName: "HH", 
        width: 80, 
        field: "ts_out_of_sight",
        valueGetter: (value) => {
          return moment(value.data.ts_out_of_sight, "YYYY-MM-DD HH:mm").format("HH") 
        },
        filter: "agNumberColumnFilter"
      },
      {
        headerName: "mm", 
        width: 80, 
        field: "ts_out_of_sight",
        valueGetter: (value) => {
          return moment(value.data.ts_out_of_sight, "YYYY-MM-DD HH:mm").format("mm") 
        },
        filter: "agNumberColumnFilter"
      },
      ]
        },
      {
        headerName: "ISO3", field: "ship_flag", width: 80, filter: "agTextColumnFilter",
      },
      {
        headerName: "Agency", field: "agency", filter: "agTextColumnFilter",
      },
    ];

    var gridOptions = {
      defaultColDef: {
        resizable: true,
      },
      components: {
        agDateInput: CustomDateComponent
      },
      columnDefs: columnDefs
    }


  // lookup the container we want the Grid to use
  var eGridDiv = document.querySelector('#myGrid');

  // create the grid passing in the div to use together with the columns & data we want to use
  new agGrid.Grid(eGridDiv, gridOptions)

  
  // lookup the container we want the Grid to use        
  var uri = "".concat({{.SHIPFLOW_SERVER}}, "/departuresToday/", {{.portinformer}});
  
  buildGrid(uri, gridOptions);

  window.setInterval(()=>{
    Pace.restart();
    buildGrid(uri, gridOptions);
  }, 60000);


</script>


{{ end }}


